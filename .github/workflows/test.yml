name: Test LaraPanel Pkg

on:
  push:
    branches:
      - master
  # pull_request:
  #   branches:
  #     - master

jobs:
  install-laravel:
    strategy:
      matrix:
        php-version: [8.2, 8.3]
        laravel-version: ["10.*", "11.*"]
    uses: weprodev/LaraPanel/.github/workflows/install-laravel.yml@master
    with:
      php-version: ${{ matrix.php-version }}
      laravel-version: ${{ matrix.laravel-version }}

  test-execution:
    needs: install-laravel

    strategy:
      matrix:
        laravel-version: ["10.*", "11.*"]
    runs-on: ubuntu-latest

    steps:
      - name: Install LaraPanel Package
        run: |
          cd laravel-${{ matrix.laravel-version }}
          composer require weprodev/larapanel

      - name: Run E2E Tests
        env:
          APP_ENV: testing
          CACHE_DRIVER: array
          SESSION_DRIVER: array
          QUEUE_CONNECTION: sync
          DB_CONNECTION: sqlite
          DB_DATABASE: ./database/database.sqlite
        run: |
          cd laravel-${{ matrix.laravel-version }}
          php artisan migrate --force
          php artisan test
